#include "p2p_real.hpp"

p2p_real::p2p_real()
{
	path::create_required_directories();

	//setup proxies for async getter/setter function calls
	max_connections_proxy = database::table::preferences::get_max_connections();
	max_download_rate_proxy = database::table::preferences::get_max_download_rate();
	max_upload_rate_proxy = database::table::preferences::get_max_upload_rate();

/*
	Network(
		&failed_connect_call_back,
		&connect_call_back,
		&disconnect_call_back,
		network::proactor::max_connections_supported() / 2,
		network::proactor::max_connections_supported() / 2,
		settings::P2P_PORT
	)
*/
}
/*
void p2p_real::connect_call_back(network::socket_data & Socket)
{
}

void p2p_real::disconnect_call_back(network::socket_data & Socket)
{

}

void p2p_real::failed_connect_call_back(const std::string & host, const std::string & port, const network::ERROR error)
{

}
*/
p2p_real::~p2p_real()
{

}

void p2p_real::current_downloads(std::vector<download_status> & CD)
{

}

void p2p_real::current_uploads(std::vector<upload_status> & CU)
{

}

unsigned p2p_real::get_max_connections()
{
	return max_connections_proxy;
}

unsigned p2p_real::get_max_download_rate()
{
	return max_download_rate_proxy;
}

unsigned p2p_real::get_max_upload_rate()
{
	return max_upload_rate_proxy;
}

void p2p_real::pause_download(const std::string & hash)
{

}

unsigned p2p_real::prime_count()
{
	return prime_generator::singleton().prime_count();
}

boost::uint64_t p2p_real::share_size_bytes()
{
	return share::singleton().size_bytes();
}

boost::uint64_t p2p_real::share_size_files()
{
	return share::singleton().size_files();
}

//boost::bind can't handle default parameter, wrapper required
static void set_max_connections_wrapper(const unsigned max_connections)
{
	database::table::preferences::set_max_connections(max_connections);
}
void p2p_real::set_max_connections(const unsigned max_connections)
{
	max_connections_proxy = max_connections;
	thread_pool::singleton().queue(boost::bind(&set_max_connections_wrapper,
		max_connections));
}

//boost::bind can't handle default parameter, wrapper required
static void set_max_download_rate_wrapper(const unsigned max_download_rate)
{
	database::table::preferences::set_max_download_rate(max_download_rate);
}
void p2p_real::set_max_download_rate(const unsigned max_download_rate)
{
	max_download_rate_proxy = max_download_rate;
	thread_pool::singleton().queue(boost::bind(&set_max_download_rate_wrapper,
		max_download_rate));
}

//boost::bind can't handle default parameter, wrapper required
static void set_max_upload_rate_wrapper(const unsigned max_upload_rate)
{
	database::table::preferences::set_max_upload_rate(max_upload_rate);
}
void p2p_real::set_max_upload_rate(const unsigned max_upload_rate)
{
	max_upload_rate_proxy = max_upload_rate;
	thread_pool::singleton().queue(boost::bind(&set_max_upload_rate_wrapper,
		max_upload_rate));
}

void p2p_real::start_download(const download_info & DI)
{

}

void p2p_real::remove_download(const std::string & hash)
{

}

unsigned p2p_real::download_rate()
{
	return 123;
}

unsigned p2p_real::upload_rate()
{
	return 123;
}
